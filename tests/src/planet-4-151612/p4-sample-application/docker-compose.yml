version: '3'
services:
  openresty:
    image: gcr.io/planet-4-151612/openresty:${OPENRESTY_BUILD_TAG:-develop}
    volumes:
      - data:/app/www
    ports:
      - "80:80"
    environment:
      - APP_ENV=develop
      - APP_HOSTNAME=${APP_HOSTNAME:-test.planet4.dev}
      - PHP_ENABLED=true
      - SSL_ENABLED=false
    depends_on:
      - php-fpm

  php-fpm:
    image: gcr.io/planet-4-151612/p4-sample-application_php-fpm
    dns:
      - ${DNS_RESOLVER:-8.8.8.8}
    ports:
      - "9000:9000"
    environment:
      - APP_ENV=develop
      - APP_HOSTNAME=${APP_HOSTNAME:-test.planet4.dev}
    env_file:
      - db.env
    volumes:
      - data:/app/source/public

  db:
    image: ${DB_IMAGE:-mysql:5.7}
    env_file:
      - db.env

  redis:
    image: redis:4-alpine

volumes:
  data:
